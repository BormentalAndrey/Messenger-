name: Android CI - Unpack Termux

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  unpack:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Если репозиторий публичный, этот параметр может помочь обойти баг
          persist-credentials: false 

      - name: Extract and Move to Termux-library
        run: |
          # Переменные
          ZIP_PATH="termux-library/termux-app-master.zip"
          DEST_DIR="Termux-library"
          
          # Проверка наличия архива
          if [ ! -f "$ZIP_PATH" ]; then
            echo "::error::Архив $ZIP_PATH не найден!"
            exit 1
          fi

          # Создаем временную папку для распаковки
          mkdir -p tmp_unpack
          unzip -q "$ZIP_PATH" -d tmp_unpack

          # Создаем чистую целевую папку Termux-library
          mkdir -p "$DEST_DIR"

          # Перемещаем содержимое из вложенной папки архива в корень Termux-library
          # shopt -s dotglob позволяет захватить скрытые файлы (.gitignore и др.)
          shopt -s dotglob
          mv tmp_unpack/termux-app-master/* "$DEST_DIR/"

          # Удаляем временные файлы
          rm -rf tmp_unpack
          
          echo "✅ Готово! Содержимое архива теперь в папке $DEST_DIR"

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: termux-library-ready
          path: Termux-library/
          
