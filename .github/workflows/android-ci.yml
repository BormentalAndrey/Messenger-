name: Unzip and Prepare Library

on:
  push:
    branches: [ "main", "master" ]

jobs:
  extract:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout your repository
        uses: actions/checkout@v4

      - name: Extract Termux Library
        run: |
          # 1. Распаковываем архив в папку termux-library
          # -q (quiet) подавляет вывод тысяч строк логов
          # -o (overwrite) перезаписывает файлы, если они уже есть
          unzip -qo termux-library/termux-app-master.zip -d termux-library/

          # 2. Исправляем структуру (вынимаем файлы из вложенной папки в корень модуля)
          # GitHub ZIP всегда создает папку 'termux-app-master' внутри
          if [ -d "termux-library/termux-app-master" ]; then
            echo "Moving files out of nested folder..."
            mv termux-library/termux-app-master/* termux-library/
            mv termux-library/termux-app-master/.[!.]* termux-library/ 2>/dev/null || true
            rm -rf termux-library/termux-app-master
          fi

          # 3. Проверка результата (выведет список файлов для отладки)
          echo "Current termux-library content:"
          ls -F termux-library/
          
