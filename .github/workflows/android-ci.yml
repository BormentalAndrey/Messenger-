name: Android CI - Unpack Termux

on:
  workflow_dispatch:

# Добавляем права на чтение репозитория
permissions:
  contents: read

jobs:
  unpack:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Используем встроенный токен GitHub
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Unpack termux-app
        run: |
          # Переменные путей
          ARCHIVE="termux-library/termux-app-master.zip"
          EXTRACT_DIR="tmp_extract"
          FINAL_DEST="termux-library/termux-app"

          # 1. Проверка наличия архива
          if [ ! -f "$ARCHIVE" ]; then
            echo "::error::Файл $ARCHIVE не найден. Проверьте путь в репозитории."
            exit 1
          fi

          # 2. Подготовка папок
          mkdir -p "$FINAL_DEST"

          # 3. Распаковка во временную папку
          unzip -q "$ARCHIVE" -d "$EXTRACT_DIR"

          # 4. Перемещение содержимого
          # Используем dotglob, чтобы переместить и скрытые файлы (.gradle, .gitignore)
          shopt -s dotglob
          mv "$EXTRACT_DIR"/termux-app-master/* "$FINAL_DEST/"
          
          # 5. Очистка
          rm -rf "$EXTRACT_DIR"
          echo "✅ Распаковка завершена успешно"

      - name: Upload unpacked artifact
        uses: actions/upload-artifact@v4
        with:
          name: termux-app-source
          path: termux-library/termux-app
          retention-days: 5
          
