name: Android CI - Unpack Termux

on:
  workflow_dispatch:

jobs:
  unpack:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Extract and Move to Termux-library
        run: |
          # 1. Определяем переменные
          ARCHIVE="termux-library/termux-app-master.zip"
          TARGET_DIR="Termux-library"
          TMP_DIR="tmp_unpack"

          # 2. Проверяем наличие исходного архива
          if [ ! -f "$ARCHIVE" ]; then
            echo "::error::Архив $ARCHIVE не найден!"
            exit 1
          fi

          # 3. Распаковываем во временную папку
          unzip -q "$ARCHIVE" -d "$TMP_DIR"

          # 4. Создаем целевую папку (если её нет)
          mkdir -p "$TARGET_DIR"

          # 5. Перемещаем содержимое из папки внутри архива (termux-app-master) 
          # напрямую в Termux-library. shopt -s dotglob захватывает скрытые файлы.
          shopt -s dotglob
          mv "$TMP_DIR"/termux-app-master/* "$TARGET_DIR/"

          # 6. Очистка
          rm -rf "$TMP_DIR"
          
          echo "✅ Все файлы перемещены в $TARGET_DIR"

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: termux-library-content
          path: Termux-library/
          retention-days: 1
          
