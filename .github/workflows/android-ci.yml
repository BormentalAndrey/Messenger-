name: Android CI Build

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    # 1. Распаковка архива
    - name: Unzip Termux Library
      run: |
        echo "Распаковка библиотеки..."
        unzip -q termux-library/termux-app-master.zip -d termux-library/
        # Переносим содержимое из вложенной папки (если она создалась) в корень модуля
        # Обычно мастер-зип создает папку termux-app-master внутри
        if [ -d "termux-library/termux-app-master" ]; then
          mv termux-library/termux-app-master/* termux-library/
          rm -rf termux-library/termux-app-master
        fi
        ls -R termux-library/ # Проверка структуры для логов

    # 2. Настройка JDK
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    # 3. Настройка прав на выполнение Gradle
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    # 4. Сборка проекта
    - name: Build with Gradle
      run: ./gradlew assembleDebug --stacktrace
      env:
        # Если у вас есть секреты для подписи или ключей
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        
